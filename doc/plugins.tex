\section{List of Filters and associated plug-ins}
\label{ch:plugins}


This chapter lists all the plugins available in mia. 
The descriptions follow the following pattern: 

\begin{description}
\item [Plugin:]\emph{the name by which the plugin is selected on the command
line}
\item [Description:] A description of the filter
\item [Parameters:] a list of the plugin parameters

\plugtabstart
parameter name& parameter type& description of the parameter & default value\\\hline
\end{tabular}
\end{description}

\subsection{2D image filters}
\label{sec:2dfilters}

In this section the following notation is used: $g$ indicates the source image,  
   $\hat{f}$ is the output image, and $S_{xy}$ is the set of pixels that is covered by the filter mask.
For an in-depth discussion of most of the filters presented here, see, e.g., \citet{gonzales02:dip}.


  \subsubsection*{Adaptive median filter}
  \label{filter2d:adaptmed}
  
  \begin{description}
  
  \item [Plugin:] adaptmed
  \item [Description:] An adaptive median filter that works like follows: 

  \begin{itemize}
    \item filter width is w=2*n+1
    \item start with n=1
    \begin{itemize}
      \item  if the resulting filtered value is equal to the min or max of the covered
             area (max or min) then increase n and repeat filtering
      \item  repeat above algorithm until n=n\_max or resulting value is not equal to an
             extreme value
    \end{itemize}     
    \item if the original intensity value of the image is equal to one of the extremes,
          then keep the value, otherwise replace it by the filter result
  \end{itemize}

  \item [Input:] Abitrary gray scale image 
  \item [Output:] The filtered image of the same pixel type and dimension 
  
  \plugtabstart
  w &  int & maximum filter width parameter & 2  \\
  \plugtabend
  
  \item [Remark:] for bit valued images this is just the normal median filter applied with the maximum filter width.
  
  \end{description}


  \subsubsection*{Adaptive median filter}
  \label{filter2d:adaptmed}
  
  \begin{description}
  
  \item [Plugin:] admean
  \item [Description:] An adaptive mean filter that works like a normal mean filter, if the intensity 
        variation within the filter mask is lower then the intensity variation in the whole image, 
	that the uses a special formula if the local variation is higher then the image intensity variation.
  \item [Input:] Abitrary gray scale image 
  \item [Output:] The filtered image of the same pixel type and dimension 
  
  \plugtabstart
  w &  int & filter width parameter & 1  \\
  \plugtabend
  
  \end{description}


  \subsubsection*{Anisotropic filtering}
  \label{filter2d:aniso}
  
  \begin{description}
  
  \item [Plugin:] aniso
  \item [Description:] Run a anisotropic filter on the input image 
  \item [Input:] Abitrary gray scale image 
  \item [Output:] The filtered image of the same pixel type and dimension 
  
  \plugtabstart
  iter & int & maximum number of iterations & 100 \\
  epsilon & float & stop iteration if changes fall below this value & 1.0  \\
  k & float & k the noise threshold ($\le 0$: adaptive) & -1 \\
  psi & string & Edge stopping funtion (ps1|ps2|tuckey|guess) & - \\
  n & int & neighbourhood shape (4|8) &  8 \\
  \plugtabend
  
  \item [Remark:] For mor information see \cite{perona90:aniso}. 
  
  \end{description}

   
   \subsubsection*{Intensity based bandpass filter}
   \begin{description}
   \item [Plugin:]bandpass
   \item [Description:]An intensity band pass filter - all pixels with intensities
   outside the given range are set to zero, all other pixels remain the
   same ($x:=x\in [min,max]\:?\: x\::\:0$
   \item [Parameters:] min, max
   
   \plugtabstart
   min&  float&  lower bound of the bandpass range &0\\\hline
   max&  float&  upper bound of the bandpass range &3.40282e+38\\\hline
   \end{tabular}
   \end{description}
   

   \subsubsection*{Binarize Filter}
   \begin{description}
   \item [Plugin:]binarize
   \item [Description:]An binarize filter - all pixels with intensities
   outside the given range are set to zero, all other pixels are set to one
   same ($x:=x\in [min,max]\:?\: x\::\:0$
   \item [Parameters:] min, max
   
   \plugtabstart
   min&  float&  lower bound of the intensity range &0\\\hline
   max&  float&  upper bound of the intensity range &3.40282e+38\\\hline
   \end{tabular}
   \end{description}
   
   
   \subsubsection*{Pixel value conversion}
   \label{filter2d:convert}
   
   \begin{description}
   \item [Plugin:]convert
   \item [Description:] Pixel conversion filter
   \item [Conversions:] Mapping methods 
   \begin{description}
   \item [copy:] pixel values are copied, values outside of the target range are clipped
   \item [linear:] pixel values are transformed according to $x \rightarrow a \times x + b$ , 
       values outside of the target range are clipped
   \item [opt:] The range of the input pixels \emph{found in the input image} 
       is mapped to the range of the output type. 
   \item [range:] The range of the input pixel \emph{type} is mapped to the range of the output type. 
   \end{description}
   \item [Parameters:] a, b, map, repn
   
   \plugtabstart
   a&  float&  scaling for linear mapping & 1.0\\\hline
   b&  float&  shift of linear mapping    & 0.0\\\hline
   map& string & type of mapping (copy|linear|opt|range) & opt\\\hline
   repn & string & target pixel type ( sbyte | ubyte | sshort | ushort |
				sint | uint | slong | ulong | float | double) & ubyte \\\hline
   \plugtabend
   
   \end{description}

   
   \subsubsection*{Image cropping}
   \label{filter2d:crop}
   
   \begin{description}
   
   \item [Plugin:] crop
   \item [Description:] Crop a region of an image, the region is always clamped to the original image size. 
   \item [Input:] Abitray grayscale image 
   \item [Output:] A gray scale image that contains the cropped region. 
   
   \plugtabstart
   start & 2D vector & upper left corner of the requested sub-region  & <0,0>  \\
   end & 2D vector & lower right corner of the requested sub-region, a value of -1 refers the size of the 
      original image in that dimension  & <-1,-1>  \\
   \plugtabend
   
   \end{description}

   
   \subsubsection*{Run a filter in the frequency domain}
   \label{filter2d:cst}
   
   \begin{description}
   
   \item [Plugin:] cst
   \item [Description:] Run a filter in the frequency domain by applying a cosinus or sinus transformation, 
         running the filter, and applying the backward cosinus or sinus transformation. 
   \item [Input:] Abitrary gray scale or binary image 
   \item [Output:] The filtered image of the same pixel type and dimension 
   
   \plugtabstart
   k & string & filter kernel as provided by the 2D cst kernel plugin handler \ref{sec:cst2dkern} &   \\
   \plugtabend
   
   \item [Remark:] Currently, no kernels are implemented. 
   
   \end{description}

   
   \subsubsection*{Downscale an image}
   \label{filter2d:downscale}
   
   \begin{description}
   
   \item [Plugin:] downscale
   \item [Description:] Downscale the input image by using a given block size to define the 
            downscale factor. Prior to scaling the image is filtered by a smoothing filter to eliminate 
	    high frequency data and avoid aliasing artifacts. 
   \item [Input:] Abitrary gray scale or binary image 
   \item [Output:] The downscaled image.  
   
   \plugtabstart
   bx & int & downscale factor in x direction & 1  \\
   by & int & downscale factor in y direction & 1  \\
   b & string & Alternative to define the scaling factors as a 2D vector & <1,1>  \\
   kernel & string & Base type of the smoothing kernel, the filter kernel width is estimated based 
       on the downscale factors & gauss \\
   \plugtabend
   
   \end{description}

   
   \subsubsection*{Norm of a normalized gradient field of the image}
   \label{filter2d:ngfnorm}
   
   \begin{description}
   
   \item [Plugin:] ngfnorm
   \item [Description:] This filter evaluates the norm of a normalized gradient field of the input image
   \item [Input:] An abitrary gray scale image. 
   \item [Input:] The norm of the normalized gradient field of the input image as a single float valued 
             image of the same dimension as th einput image. 
   
   \end{description}
   This plugin doesn't take parameters. 

   
   \subsubsection*{An image scaling filter}
   \label{filter2d:scale}
   
   \begin{description}
   
   \item [Plugin:] scale
   \item [Description:] A 2D image filter to scale images. 
   \item [Input:] An abitrary gray scale image. 
   \item [Input:] The scaled image with the same pixel type.  
   
   \plugtabstart
   sx & int & target width & 128 \\
   sy & int & target height & 128 \\
   interp & string & interpolation kernel descriptor & "bspline3" \\
   \plugtabend

   \item [Remark:] Currently downscaling is not handled correctly. 
   
   \end{description}

   
   \subsubsection*{Spacial separable convolution filter}
   \label{filter2d:selectbig}
   
   \begin{description}
   
   \item [Plugin:] selectbig
   \item [Description:] A 2D filter that creats a binary mask representing the intensity with the highest pixel count. 
   The pixel value 0 will be ignored, and if two intensities have the same pixel count, then the result is undefined. 
   \item [Input:] An image with integral intensity values, usually this will be the output of the 
         label filter \ref{filter2d:label}. 
   \item [Input:] An binary image with a mask that represents the pixels with the highest pixel count. 

   This plug-in takes no parameters. 
   
   \end{description}

   
   \subsubsection*{Spacial separable convolution filter}
   \label{filter2d:sepconv}
   
   \begin{description}
   
   \item [Plugin:] sepconv
   \item [Description:] A 2D image filter that runs separable ove each dimension 
   \item [Input:] Abitrary gray scale image 
   \item [Output:] Filtered gray scale image of the same pixel type and dimension
   
   \plugtabstart
   kx &  string & Filter kernel in x-direction as available through the spacial kernel plug-ins \ref{sec:SpacialKernels}
      & gauss:w=1    \\
   ky &  string & Filter kernel in y-direction as available through the spacial kernel plug-ins \ref{sec:SpacialKernels}
      & gauss:w=1    \\
   \plugtabend
   
   \end{description}

   
   \subsubsection*{Threshhold filter with neighbourhood preservation}
   \label{filter2d:thresh}
   
   \begin{description}
   
   \item [Plugin:] thresh
   \item [Description:] set a pixel value to zero if all neighborhood values are below a given threshhold 
   \item [Input:] Abitrary gray scale image 
   \item [Output:] Filtered gray scale image of the same pixel type and dimension

   \plugtabstart
   shape &  string & neighbourhood shape as available through the shape plugins \ref{sec:2dshapes} & 4n \\
   thresh&  float  & threshhold value & 5.0\\
   \plugtabend
   
   \end{description}


%
%
%

\subsection{3D Filter}
\label{sec:3dfilters}

\subsubsection*{Binarize Filter}
\begin{description}
\item [Plugin:]binarize
\item [Description:]An binarize filter - all pixels with intensities
outside the given range are set to zero, all other pixels are set to one
same ($x:=x\in [min,max]\:?\: x\::\:0$
\item [Parameters:] min, max

\plugtabstart
min&  float&  lower bound of the intensity range &0\\\hline
max&  float&  upper bound of the intensity range &3.40282e+38\\\hline
\end{tabular}
\end{description}


\subsubsection*{Bandpass Intensity Filter}
\begin{description}
\item [Plugin:]bandpass
\item [Description:]An intensity band pass filter - all pixels with intensities
outside the given range are set to zero, all other pixels remain the
same ($x:=x\in [min,max]\:?\: x\::\:0$
\item [Parameters:] min, max

\plugtabstart
min&  float&  lower bound of the bandpass range &0\\\hline
max&  float&  upper bound of the bandpass range &3.40282e+38\\\hline
\end{tabular}
\end{description}

\subsubsection*{Convesion of pixel types}
\begin{description}
\item [Plugin:]convert
\item [Description:] Pixel conversion filter
\item [Conversions:] Mapping methods 
\begin{description}
\item [copy:] pixel values are copied, values outside of the target range are clipped
\item [linear:] pixel values are transformed according to $x \rightarrow a \times x + b$ , 
                 values outside of the target range are clipped
\item [opt:] The range of the input pixels \emph{found in the input image} 
		is mapped to the range of the output type. 
\item [range:] The range of the input pixel \emph{type} is mapped to the range of the output type. 
\end{description}
\item [Parameters:] a, b, map, repn

\plugtabstart
a&  float&  scaling for linear mapping & 1.0\\\hline
b&  float&  shift of linear mapping    & 0.0\\\hline
map& string & type of mapping (copy|linear|opt|range) & opt\\\hline
repn & string & target pixel type ( sbyte | ubyte | sshort | ushort |
				sint | uint | slong | ulong | float | double) & ubyte \\\hline
\end{tabular}
\end{description}


\subsubsection*{Downscale Filter}

\begin{description}
\item [Plugin:] downscale
\item [Description:] An filter that uses a seperable kernel to filter a 3D image. 
	For available kernels see Section \ref{sec:spacialkern}
\item [Parameters:] bx, by, bz, kernel

\plugtabstart 
bx & int &  blocksize in x direction  $\in [1,2147483647]$ & 1 \\\hline
by & int &  blocksize in y direction  $\in [1,2147483647]$ & 1 \\\hline
bz & int &  blocksize in z direction  $\in [1,2147483647]$ & 1 \\\hline
kernel & string &   smoothing filter kernel type to be applied  & gauss \\\hline
\end{tabular}
\end{description}


\subsubsection*{Gaussian Smoothing}
\begin{description}
\item [Plugin:]gauss
\item [Description:] isotropic spacial gaussian smoothing filter 
\item [Parameters:] w

\plugtabstart
w&  int&  filter width parameter [0,2147483647] & 1\\\hline
\end{tabular}
\end{description}

\subsubsection*{Labeling}
\begin{description}
\item [Plugin:]label
\item [Description:] Labeling of connected components in binary images
\item [Remark:] Input image must be binary
\item [Parameters:] n

\plugtabstart
n&  string&  neighborhood mask (see Section \ref{sec:shapes3d}) & n6\\\hline
\end{tabular}
\end{description}


\subsubsection*{Morphological Erode, Dilate, Open, Close}
\begin{description}
\item [Plugin:]erode, dilate, open, close
\item [Description:] the respective morphological filters
\item [Parameters:] hint, shape

\plugtabstart
shape&  string &  structuring element (see Section \ref{sec:shapes3d}) & [sphere:r=1]\\\hline
hint & string & hint to dominant (binary) image content (black|white) & black \\\hline
\end{tabular}
\end{description}


\subsubsection*{Median Filter}
\begin{description}
\item [Plugin:]median
\item [Description:] isotropic median filter 
\item [Parameters:] w

\plugtabstart
w&  int&  filter width parameter $\in[0,2147483647]$ & 1\\\hline
\end{tabular}
\end{description}

\subsubsection*{Mean Least Variance}
\begin{description}
\item [Plugin:]mlv
\item [Description:] isotropic mean least variance filter 
\item [Parameters:] w

\plugtabstart
w&  int&  filter width parameter $\in [0,2147483647]$ & 1\\\hline
\end{tabular}
\end{description}

\subsubsection*{Separable Convolution Filter}

\begin{description}
\item [Plugin:] sepconv
\item [Description:] An filter that uses a seperable kernel to filter a 3D image. 
	For available kernels see Section \ref{sec:spacialkern}
\item [Parameters:] kx, ky, kz

\plugtabstart
kx&  string &  filter kernel applied in the x-direction & gauss:w=1 \\\hline
ky&  string &  filter kernel applied in the y-direction & gauss:w=1 \\\hline
kz&  string &  filter kernel applied in the z-direction & gauss:w=1 \\\hline
\end{tabular}
\end{description}


\subsection{3D Shapes}
\label{sec:shapes3d}

\subsubsection*{6n Neighborhood }

\begin{description}
\item [Plugin:] n6
\item [Description:] a shape object describing the 6n voxel neighbourhood.
\item [Parameters:] 
\end{description}

\subsubsection*{18n Neighborhood }

\begin{description}
\item [Plugin:] n18
\item [Description:] a shape object describing the 18n voxel neighbourhood.
\item [Parameters:] 
\end{description}

\subsubsection*{26n Neighborhood }

\begin{description}
\item [Plugin:] n26
\item [Description:] a shape object describing the 26n voxel neighbourhood.
\item [Parameters:] 
\end{description}

\subsubsection*{6n Neighborhood }

\begin{description}
\item [Plugin:] n6
\item [Description:] a shape object describing the 6n voxel neighbourhood.
\item [Parameters:] 
\end{description}

\subsubsection*{Sphere}

\begin{description}
\item [Plugin:] sphere
\item [Description:] a shape object describing filled sphere
\item [Parameters:] r
\end{description}
\plugtabstart
r&  float  & radius of the sphere & 2 \\\hline
\end{tabular}

\subsection{Spacial Filter Kernels}
\label{sec:spacialkern}

\subsubsection*{Gaussian Convolution Kernel}

\begin{description}
\item [Plugin:] gauss
\item [Description:] The kernel of a spacial Gaussien filter 
\item [Parameters:] w

\plugtabstart
w&  int  & half width of the kernel, actual width = $2 * w + 1$ & 1 \\\hline
\end{tabular}
\end{description}

\subsection{3D Image Combination}
\label{sec:3dcombiners}

\subsubsection*{Label X-reference map}

\begin{description}
\item [Plugin:] labelxmap
\item [Description:] Label cross referencing 
\item [Parameters:] \emph{none}
\end{description}


\subsection{Non-linear image registration}
\label{sec:nrreg}

The following plug-ins are available for both, 2D and 3D implementations of the non-rogid registration algorithms. 

\subsubsection{Cost functions}

\subsubsection*{Sum of Squared Differences}

\begin{description}
\item [Plugin:] ssd
\item [Description:] Sum of Squared Differenes: $F_\text{cost} := \int_\Omega S(x) - R(x) dx$. 
\item [Parameters:] (none)
\end{description}

\subsubsection{Registration models}

These plug-ins provide the solver for the inner loop of the registration, and correspond to the general mathematical model 
  of the registration.  

\subsubsection*{navier}

\begin{description}
\item [Plugin:] navier
\item [Description:] Image registration based on the reduced form of the Navier-Stokes-Equation. 
                       Proviedes linera elastic and fluid dynamic registration without volume preservation. 
\item [Parameters:] epsilon, iter, lambda, mu, omega
\end{description}
\plugtabstart 
epsilon & float &  blocksize in x direction  $\in [1e-6, 0.1]$ & 1e-04 \\\hline
iter & int &  blocksize in y direction  $\in [10, 10000]$ & 100 \\\hline
lambda & float &  isotropic compression $\in [0, \infty]$ & 1.0 \\\hline
mu & float &    isotropic compliance   $\in [0, \infty]$ & 1.0 \\\hline
omega & float &   relaxation parameter $\in [0.1, 10]$ & 1.0 \\\hline
\end{tabular}

\subsubsection*{naviera}

\begin{description}
\item [Plugin:] naviera
\item [Description:] Image registration based on the reduced form of the Navier-Stokes-Equation, adaptive, optimized solver. 
                      Proviedes linera elastic and fluid dynamic registration without volume preservation. 
\item [Parameters:] epsilon, iter, lambda, mu
\end{description}
\plugtabstart 
epsilon & float &  blocksize in x direction  $\in [1e-6, 0.1]$ & 1e-04 \\\hline
iter & int &  blocksize in y direction  $\in [10, 10000]$ & 100 \\\hline
lambda & float &  isotropic compression $\in [0, \infty]$ & 1.0 \\\hline
mu & float &    isotropic compliance   $\in [0, \infty]$ & 1.0 \\\hline
\end{tabular}

\subsubsection*{navierasse}
This plug-in is currently only available for 3D, and if the software was compiled with the GCC compiler or the Intel Compiler

\begin{description}
\item [Plugin:] navierasse
\item [Description:] Image registration based on the reduced form of the Navier-Stokes-Equation, adaptive, optimized solver. 
		      Supports SSE on the Intel platform and AltiVec on PowerPC. 
                      Proviedes linera elastic and fluid dynamic registration without volume preservation. 
\item [Parameters:] epsilon, iter, lambda, mu
\end{description}
\plugtabstart 
epsilon & float &  blocksize in x direction  $\in [1e-6, 0.1]$ & 1e-04 \\\hline
iter & int &  blocksize in y direction  $\in [10, 10000]$ & 100 \\\hline
lambda & float &  isotropic compression $\in [0, \infty]$ & 1.0 \\\hline
mu & float &    isotropic compliance   $\in [0, \infty]$ & 1.0 \\\hline
\end{tabular}

\subsubsection{Timestep models}

These plug-ins provide the time step evaluation in the outer iteration of the registration. 

	
\subsubsection*{Direct evaulation}

\begin{description}
\item [Plugin:] direct
\item [Description:] Provides a ``direct'' time stepping - in the Navier-based models this corrensponds to a linear elastic registration. 
\item [Parameters:] min,max
\end{description}

\plugtabstart 
min & float &  minimum time step $\in [0.001, \infty]$ & 0.1 \\\hline
max & float &  maximum time step $\in [0.002, \infty]$ & 2.0 \\\hline
\end{tabular}

\subsubsection*{Fluid Dynamics}

\begin{description}
\item [Plugin:] fluid
\item [Description:] Provides time stepping that corrensponds to a fluid dynamic model in the Navier-based registration model. 
\item [Parameters:] min,max
\end{description}

\plugtabstart 
min & float &  minimum time step $\in [0.001, \infty]$ & 0.1 \\\hline
max & float &  maximum time step $\in [0.002, \infty]$ & 2.0 \\\hline
\end{tabular}




